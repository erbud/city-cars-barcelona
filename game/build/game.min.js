var BasicGame={score:0,music:!0,orientated:!1,width:1024,height:768};navigator.isCocoonJS&&cocoonjsphaser.utils.fixDOMParser(),window.onload=function(){var e=new Phaser.Game(1024,768,Phaser.CANVAS,"game",null,!1,!1);e.state.add("Boot",BasicGame.Boot),e.state.add("Preloader",BasicGame.Preloader),e.state.add("MainMenu",BasicGame.MainMenu),e.state.add("Game",BasicGame.Game),e.state.add("GameEnd",BasicGame.GameEnd),e.state.start("Boot")},Phaser.BitmapText.prototype.anchor=new Phaser.Point,Phaser.BitmapText.prototype.update=function(){null!==this.anchor&&(this.updateTransform(),this.pivot.x=this.anchor.x*this.textWidth,this.pivot.y=this.anchor.y*this.textHeight)},BasicGame.Boot=function(){},BasicGame.Boot.prototype={init:function(){this.input.maxPointers=1,this.stage.disableVisibilityChange=!0,this.game.device.desktop?(this.scale.scaleMode=Phaser.ScaleManager.EXACT_FIT,this.scale.setMinMax(480,260,1024,768),this.scale.pageAlignHorizontally=!0,this.scale.pageAlignVertically=!0,this.scale.setScreenSize(!0),this.scale.refresh()):(this.scale.scaleMode=Phaser.ScaleManager.EXACT_FIT,this.scale.setMinMax(480,260,1024,768),this.scale.pageAlignHorizontally=!0,this.scale.pageAlignVertically=!0,this.scale.forceOrientation(!0,!1),this.scale.setResizeCallback(this.gameResized,this),this.scale.enterIncorrectOrientation.add(this.enterIncorrectOrientation,this),this.scale.leaveIncorrectOrientation.add(this.leaveIncorrectOrientation,this),this.scale.setScreenSize(!0),this.scale.refresh())},preload:function(){var t=this.game.device.cocoonJS?"json":"xml";this.load.bitmapFont("munro","assets/fonts/munro.png","assets/fonts/munro."+t),this.load.image("preloaderBackground","assets/img/preloader-background.png"),this.load.image("preloaderBar","assets/img/preloader-bar.png"),t=null},create:function(){this.state.start("Preloader")},gameResized:function(){},enterIncorrectOrientation:function(){BasicGame.orientated=!1},leaveIncorrectOrientation:function(){BasicGame.orientated=!0}},BasicGame.Game=function(){this.game,this.add,this.camera,this.cache,this.input,this.load,this.math,this.sound,this.stage,this.time,this.tweens,this.world,this.particles,this.physics,this.rnd,this.map,this.mapLayerPlatforms,this.mapBackground,this.mapSky,this.music,this.player,this.cursors,this.jumpButton,this.levelCompleted=!1,this.level=0,this.levelScore=0,this.levelCountTiles=0,this.lives=0,this.fuel=0,this.countdown=0,this.gameSpeed=0,this.resources=0,this.bmdTerrain,this.groupActors,this.groupInterface,this.interfaceTouchControls,this.interfaceTouchControlsLeft,this.interfaceTouchControlsRight,this.interfaceTouchControlsJump,this.interfaceCountdown,this.interfaceCountdownBox,this.interfaceCountdownLevel,this.interfaceLife,this.interfaceFuel,this.interfaceMute,this.interfacePause,this.interfaceLevelScore,this.interfaceLevelCompleted,this.interfaceLevelCompletedBg,this.interfaceGameOver,this.interfaceGameOverBg,this.listenerEnemies},BasicGame.Game.prototype={init:function(t,e){this.level=t||1,this.lives=e||5,this.levelCompleted=!1,this.levelScore=0,this.fuel=200,this.countdown=5,this.gameSpeed=275,this.resources=this.level<=3?1:this.level>=4&&this.level<=6?2:this.level>=7&&this.level<=9?3:4},preload:function(t){t.load.tilemap("mapLevel","assets/tilemaps/maps/tilemap-"+this.level+".json",null,Phaser.Tilemap.TILED_JSON),t.load.audio("musicLevel","assets/audio/single-"+this.getMusic()+".ogg"),t.load.audio("effectLevelCompleted","assets/audio/police-radio.ogg"),t.load.audio("effectGameOver","assets/audio/police-siren.ogg"),t.load.image("mapBackground","assets/img/bg-"+this.resources+".png"),t.load.image("mapSky","assets/img/bg-"+this.resources+"-sky-"+this.getSkyType()+".png"),t.load.image("mapTerrain","assets/tilemaps/tiles/terrain-"+this.resources+".png"),t.load.image("mapTerrain1","assets/img/terrain-"+this.resources+"-tile-1.png"),t.load.image("mapTerrain2","assets/img/terrain-"+this.resources+"-tile-2.png"),t.load.image("mapTerrain3","assets/img/terrain-"+this.resources+"-tile-3.png"),t.load.image("mapTerrain4","assets/img/terrain-"+this.resources+"-tile-4.png"),t.load.spritesheet("btMusic","assets/img/bt-music-game.png",50,50)},create:function(t){var e={};this.physics.startSystem(Phaser.Physics.ARCADE),this.physics.arcade.gravity.y=800,this.mapSky=this.add.tileSprite(0,0,4608,704,"mapSky"),this.mapBackground=this.add.tileSprite(0,225,4608,704,"mapBackground"),this.map=this.add.tilemap("mapLevel"),this.map.addTilesetImage("terrain","mapTerrain"),this.mapLayerPlatforms=this.map.createLayer(0),this.mapLayerPlatforms.resizeWorld(),this.map.setCollision([1,2,3,4],!0,0),this.levelCountTiles=this.countTilesOfTheLevel(),this.bmdTerrain=this.add.bitmapData(this.map.widthInPixels,this.map.heightInPixels),e=this.add.image(0,0,this.bmdTerrain),this.groupActors=this.add.group(),this.addInterface(),this.camera.focusOnXY(100,650),this.music=this.add.audio("musicLevel"),BasicGame.music&&this.music.play("",0,1,!0),this.time.events.add(0,this.setCountdown,this),t.onPause.add(this.onGamePause,this),t.onResume.add(this.onGameResume,this)},update:function(t){this.groupActors.countLiving()>0&&this.physics.arcade.collide([this.mapLayerPlatforms,this.player],this.groupActors,this.onCollision,null,this),this.interfaceLevelCompleted&&this.levelCompleted&&this.interfaceLevelCompleted.updateCrop(),t.input.onDown.add(function(){t.paused=!1},this)},render:function(){},shutdown:function(){this.time.events.remove(this.listenerEnemies),this.groupActors.destroy(),this.groupInterface.destroy(),this.map.destroy(),this.interfaceLevelCompletedBg&&this.interfaceLevelCompletedBg.destroy(),this.interfaceLevelCompleted&&this.interfaceLevelCompleted.destroy(),this.interfaceGameOverBg&&this.interfaceGameOverBg.destroy(),this.interfaceGameOver&&this.interfaceGameOver.destroy(),this.cache.removeTilemap("mapLevel"),this.cache.removeSound("musicLevel"),this.cache.removeSound("effectLevelCompleted"),this.cache.removeSound("effectGameOver"),this.cache.removeImage("mapBackground"),this.cache.removeImage("mapSky"),this.cache.removeImage("mapTerrain"),this.cache.removeImage("mapTerrain1"),this.cache.removeImage("mapTerrain2"),this.cache.removeImage("mapTerrain3"),this.cache.removeImage("mapTerrain4"),this.cache.removeImage("btMusic")},initGame:function(){var t=this.level<=3?3*Phaser.Timer.SECOND:this.level>=4&&this.level<=9?2*Phaser.Timer.SECOND:Phaser.Timer.SECOND;this.cursors=this.input.keyboard.createCursorKeys(),this.jumpButton=this.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR),this.interfaceCountdown.destroy(),this.interfaceCountdownBox.destroy(),this.interfaceCountdownLevel.destroy(),this.interfaceCountdown=null,this.interfaceCountdownBox=null,this.interfaceCountdownLevel=null,this.addPlayer(),this.camera.follow(this.player),this.time.events.add(20*Phaser.Timer.SECOND,this.addItem,this,"Fuel",!0),this.time.events.add(this.rnd.between(Phaser.Timer.MINUTE/4,Phaser.Timer.MINUTE/2),this.addItem,this,"Obstacle",!0),this.time.events.add(this.rnd.between(1.5*Phaser.Timer.MINUTE,2*Phaser.Timer.MINUTE),this.addItem,this,"Power",!0),this.time.events.add(this.rnd.between(2*Phaser.Timer.MINUTE,2.5*Phaser.Timer.MINUTE),this.addItem,this,"Life",!0),this.listenerEnemies=this.time.events.loop(t,this.addEnemy,this),t=null},quitGame:function(t){var e=this.game;t.stop(),t.destroy(),t=null,this.game.device.cocoonJS&&this.level%2!==0&&(Cocoon.Ad.interstitial.on("shown",function(){e.paused=!0}),Cocoon.Ad.interstitial.on("hidden",function(){e.paused=!1,e=null}),Cocoon.Ad.showInterstitial()),this.state.start("MainMenu")},gameOver:function(){var t={},e=this.add.audio("effectGameOver"),i=this.add.bitmapData(this.camera.width,this.camera.height);BasicGame.score+=this.levelScore,this.saveScore(),BasicGame.score=0,this.time.events.removeAll(),this.mapBackground.stopScroll(),this.music.stop(),this.interfaceMute.alpha=.4,this.interfacePause.alpha=.4,this.game.device.touch&&(this.add.tween(this.interfaceTouchControlsLeft).to({y:this.camera.height},1e3,Phaser.Easing.Bounce.Out,!0,100),this.add.tween(this.interfaceTouchControlsRight).to({y:this.camera.height},1e3,Phaser.Easing.Bounce.Out,!0,100),this.add.tween(this.interfaceTouchControlsJump).to({y:this.camera.height},1e3,Phaser.Easing.Bounce.Out,!0,100)),i.ctx.fillStyle="#b9b9b9",i.ctx.beginPath(),i.ctx.rect(0,0,i.width,20*i.height/100),i.ctx.closePath(),i.ctx.fill(),this.interfaceGameOverBg=this.add.sprite(this.camera.x-this.camera.width,300,i),this.interfaceGameOver=this.add.sprite(this.camera.x+this.camera.width/2-this.game.cache.getImage("msgGameOver").width/2,this.camera.y-500,"msgGameOver"),t=this.add.tween(this.interfaceGameOverBg).to({x:this.camera.x},1e3,Phaser.Easing.Exponential.Out,!0),t.onComplete.add(function(){var i=this.add.tween(this.interfaceGameOver).to({y:375},1200,Phaser.Easing.Bounce.Out,!0);i.onComplete.add(function(){var t=this.add.sprite(this.camera.x,315,"player"),s=this.add.sprite(this.camera.x+this.camera.width,315,"enemy-1"),a={},n={};t.animations.add("run-right",[0,1,2,3],15,!0),t.animations.add("dead-right",[10,11],15,!0),s.animations.add("run-left",[22,23,24,25],15,!0),s.animations.add("capture-left-front",[35],1,!1),t.animations.play("run-right"),s.animations.play("run-left"),a=this.add.tween(t).to({x:this.camera.x+this.camera.width/2-30},2e3,Phaser.Easing.Linear.None,!0),a.onComplete.add(function(){t.animations.play("dead-right"),t=a=null},this),n=this.add.tween(s).to({x:this.camera.x+this.camera.width/2+25},2e3,Phaser.Easing.Linear.None,!0),n.onStart.add(function(){e.play()},this),n.onComplete.add(function(){s.animations.play("capture-left-front"),s=n=null},this),i=null},this),t=null},this),this.time.events.add(9*Phaser.Timer.SECOND,this.quitGame,this,e),i=null},checkIfLevelCompleted:function(){var t={},e={};this.levelCompleted||this.levelScore!==this.levelCountTiles||(BasicGame.score+=this.levelScore,this.time.events.removeAll(),this.mapBackground.stopScroll(),this.music.stop(),this.levelCompleted=!0,this.cursors=null,this.jumpButton=null,this.player.body.immovable=!0,this.player.body.velocity.x=0,this.interfaceMute.alpha=.4,this.interfacePause.alpha=.4,this.game.device.touch&&(this.add.tween(this.interfaceTouchControlsLeft).to({y:this.camera.height},1e3,Phaser.Easing.Bounce.Out,!0,100),this.add.tween(this.interfaceTouchControlsRight).to({y:this.camera.height},1e3,Phaser.Easing.Bounce.Out,!0,100),this.add.tween(this.interfaceTouchControlsJump).to({y:this.camera.height},1e3,Phaser.Easing.Bounce.Out,!0,100)),t=this.add.bitmapData(this.camera.width,this.camera.height),t.ctx.fillStyle="#b9b9b9",t.ctx.beginPath(),t.ctx.rect(0,0,t.width,20*t.height/100),t.ctx.closePath(),t.ctx.fill(),this.interfaceLevelCompletedBg=this.add.sprite(this.camera.x-this.camera.width,300,t),e=this.add.tween(this.interfaceLevelCompletedBg).to({x:this.camera.x},1e3,Phaser.Easing.Exponential.Out,!0),e.onComplete.add(function(){var t=this.add.sprite(this.camera.x,330,"player"),i=this.add.sprite(this.camera.x-128,310,"enemy-3"),s=this.add.sprite(this.camera.x-128,330,"enemy-2"),a=this.add.sprite(this.camera.x-128,335,"enemy-1"),n={},h={},r={},o={},d={};t.animations.add("run-right",[0,1,2,3],15,!0),i.animations.add("run-right",[0,1,2,3],15,!0),s.animations.add("run-right",[0,1,2,3],15,!0),a.animations.add("run-right",[0,1,2,3],15,!0),t.animations.play("run-right"),i.animations.play("run-right"),s.animations.play("run-right"),a.animations.play("run-right"),this.interfaceLevelCompleted=this.add.sprite(this.camera.x+this.camera.width/2-this.game.cache.getImage("msgLevelCompleted").width/2,390,"msgLevelCompleted"),d=new Phaser.Rectangle(0,0,0,this.interfaceLevelCompleted.height),this.add.tween(d).to({width:this.interfaceLevelCompleted.width},4e3,Phaser.Easing.Linear.None,!0),this.interfaceLevelCompleted.crop(d),n=this.add.tween(t).to({x:this.camera.x+this.camera.width},3e3,Phaser.Easing.Linear.None,!0),h=this.add.tween(a).to({x:this.camera.x+this.camera.width},5e3,Phaser.Easing.Linear.None,!0),r=this.add.tween(s).to({x:this.camera.x+this.camera.width},5200,Phaser.Easing.Linear.None,!0),o=this.add.tween(i).to({x:this.camera.x+this.camera.width},5100,Phaser.Easing.Linear.None,!0),o.onStart.add(function(){var t=this.add.audio("effectLevelCompleted");t.play(),t=null},this),o.onComplete.add(function(){var e=this.add.button(this.camera.x+this.camera.width/2-this.cache.getImage("btContinue").width/6,this.camera.y-500,"btContinue",this.loadNextLevel,this,2,1,0);tween_msg={},t.destroy(),i.destroy(),s.destroy(),a.destroy(),this.add.tween(e).to({y:330},1200,Phaser.Easing.Bounce.Out,!0),tween_msg=this.add.tween(this.interfaceLevelCompleted).to({y:this.camera.height+100},1e3,Phaser.Easing.Bounce.Out,!0,500),tween_msg.onComplete.add(function(){this.interfaceLevelCompleted.destroy(),this.interfaceLevelCompleted=null,e=tween_msg=null},this),t=a=s=i=n=h=r=o=d=null},this),e=null},this)),t=null},checkToJump:function(t,e){var i="ceiling"===t?[1,2,3,4]:[5,6,7,8],s=this.map,a=this.mapLayerPlatforms,n={x:a.getTileX(e.x),y:a.getTileY(e.y)-5},h=!1;return(s.getTile(n.x,n.y,0)||s.getTile(n.x+e.facing*i[0],n.y,0)||s.getTile(n.x+e.facing*i[1],n.y,0)||s.getTile(n.x+e.facing*i[2],n.y,0)||s.getTile(n.x+e.facing*i[3],n.y,0))&&(h=!0),delete n.x,delete n.y,i=s=a=n=null,h},loadNextLevel:function(){var t=this.game,e=this.level+1;this.game.device.cocoonJS&&e%2===0&&(Cocoon.Ad.interstitial.on("shown",function(){t.paused=!0}),Cocoon.Ad.interstitial.on("hidden",function(){t.paused=!1,t=null}),Cocoon.Ad.showInterstitial()),12>=e?this.state.restart(!0,!1,e,this.lives):this.state.start("GameEnd"),e=null},countTilesOfTheLevel:function(){var t=0;return this.mapLayerPlatforms.layer.data.forEach(function(e){e.forEach(function(e){e.index>0&&e.index<5&&t++})}),t},addInterface:function(){var t=function(t,e){var i="0000000000000000"+t;return i.substr(i.length-e)};this.groupInterface=this.add.group(),this.interfaceLife=this.add.sprite(10,10,"lifeCounter"),this.interfaceLife.fixedToCamera=!0,this.groupInterface.add(this.interfaceLife),this.interfaceFuel=this.add.sprite(this.camera.width/2-100,10,"fuelCounter"),this.interfaceFuel.fixedToCamera=!0,this.groupInterface.add(this.interfaceFuel),this.interfaceLevelScore=this.add.bitmapText(this.camera.width-350,13,"munro",t(BasicGame.score,7)+" Km",40),this.interfaceLevelScore.tint=1118481,this.interfaceLevelScore.fixedToCamera=!0,this.interfaceLevelScore.anchor.setTo(.5,.5),this.groupInterface.add(this.interfaceLevelScore),this.interfaceMute=this.add.button(this.camera.x+this.camera.width-120,10,"btMusic",this.muteOnOff,this,2,1,0),this.interfaceMute.frame=0,this.interfaceMute.fixedToCamera=!0,this.groupInterface.add(this.interfaceMute),this.interfaceMute.frame=BasicGame.music?0:1,this.interfaceMute.onInputOut.add(function(){this.interfaceMute.frame=BasicGame.music?0:1},this),this.interfacePause=this.add.button(this.camera.x+this.camera.width-60,10,"btPause",this.pause,this,2,1,0),this.interfacePause.frame=0,this.interfacePause.fixedToCamera=!0,this.groupInterface.add(this.interfacePause),this.interfacePause.frame=this.game.paused?1:0,this.interfacePause.onInputOut.add(function(){this.interfacePause.frame=this.game.paused?1:0},this),this.updateLives(),this.updateFuel(),this.updateCountdown(),this.game.device.touch&&this.addTouchControls(),t=null},addTouchControls:function(){this.interfaceTouchControlsRight=this.add.button(10,this.camera.height-125,"btRight",this.tapController,this,2,1,0),this.interfaceTouchControlsRight.scale.setTo(.8,.8),this.interfaceTouchControlsRight.alpha=.8,this.interfaceTouchControlsRight.fixedToCamera=!0,this.interfaceTouchControlsRight.visible=!1,this.groupInterface.add(this.interfaceTouchControlsRight),this.interfaceTouchControlsLeft=this.add.button(10,this.camera.height-125,"btLeft",this.tapController,this,2,1,0),this.interfaceTouchControlsLeft.scale.setTo(.8,.8),this.interfaceTouchControlsLeft.alpha=.8,this.interfaceTouchControlsLeft.fixedToCamera=!0,this.groupInterface.add(this.interfaceTouchControlsLeft),this.interfaceTouchControlsJump=this.add.button(this.camera.width-135,this.camera.height-125,"btJump",this.tapController,this,2,1,0),this.interfaceTouchControlsJump.scale.setTo(.8,.8),this.interfaceTouchControlsJump.alpha=.8,this.interfaceTouchControlsJump.fixedToCamera=!0,this.groupInterface.add(this.interfaceTouchControlsJump)},addPlayer:function(){this.player=new Player(this.game,100,650),this.groupActors.add(this.player),this.physics.enable(this.player,Phaser.Physics.ARCADE),this.player.body.collideWorldBounds=!0,this.player.body.bounce.y=.3,this.player.body.height=this.player.body.halfHeight,this.player.run()},addEnemy:function(){var t=this.groupActors.children.filter(function(t){return"enemy"===t.name&&!t.alive},!0),e={},i=this.getActorPosition();t.length>0?(e=t.pop(),e.reset(i.x,i.y)):(e=new Enemy(this.game,i.x,i.y),this.groupActors.add(e),this.physics.enable(e,Phaser.Physics.ARCADE),e.body.collideWorldBounds=!0,e.body.bounce.y=.2,e.body.height=e.body.halfHeight),e.setFacing(),e.setVelocity(),e.run(),delete i.x,delete i.y,t=e=i=null},addTerrain:function(t,e,i){this.bmdTerrain.draw(new Phaser.Image(this.game,0,0,"mapTerrain"+t),e,i,32,32)},addItem:function(t,e,i){if("Life"!==t||5!==this.lives){var s=this.getItemPosition(),a="function"==typeof window[t]?new window[t](this.game,s.x,s.y,i):null;null!==a&&(this.groupActors.add(a),this.physics.enable(a,Phaser.Physics.ARCADE),a.body.bounce.y=.2,a.body.height=e?a.body.halfHeight:0,a.body.immovable=!0),delete s.x,delete s.y,s=a=null}},setCountdown:function(){this.countdown--,this.updateCountdown(!0),1===this.countdown?(this.interfaceCountdownLevel.setText("GOOOO!"),this.time.events.add(Phaser.Timer.SECOND,this.initGame,this)):this.time.events.add(Phaser.Timer.SECOND,this.setCountdown,this)},getActorPosition:function(){var t=this.map.widthInPixels,e=this.map.heightInPixels,i=[this.player.body.y,e-96,e-192,e-288,e-384],s={x:this.player.x>=0&&this.player.x<=this.camera.width?this.camera.x+this.camera.width+32:this.player.x>=t-this.camera.width&&this.player.x<=t?this.camera.x-32:this.rnd.normal()<0?this.camera.x+this.camera.width+32:this.camera.x-32,y:i[Math.floor(Math.random()*Math.random()*Math.random()*i.length)]};return t=e=i=null,s},getItemPosition:function(){var t=this.map.widthInPixels,e=this.map.heightInPixels,i=[e-96,e-192,e-288,e-384],s=this.rnd.between(0,3),a={x:this.camera.x>=0&&this.camera.x<=1200?this.rnd.between(this.camera.x+this.camera.width+128,t-128):this.camera.x>=5200&&this.camera.x<=t?this.rnd.between(128,this.camera.x-128):this.rnd.normal()<0?this.rnd.between(this.camera.x+this.camera.width+128,t-128):this.rnd.between(128,this.camera.x-128),y:i[s]};return t=e=i=s=null,a},getSkyType:function(){return 1===this.level||4===this.level||7===this.level||10===this.level?1:2===this.level||5===this.level||8===this.level||11===this.level?2:3===this.level||6===this.level||9===this.level||12===this.level?3:this.rnd.between(1,3)},getMusic:function(){return 1===this.level||5===this.level||9===this.level?1:2===this.level||6===this.level||10===this.level?2:3===this.level||7===this.level||11===this.level?3:4===this.level||8===this.level||12===this.level?4:this.rnd.between(1,4)},updateCountdown:function(t){t?this.interfaceCountdown.frame=this.countdown>3?1:3===this.countdown?2:1===this.countdown?3:4:(this.interfaceCountdown=this.add.sprite(this.camera.width/2-this.game.cache.getImage("countdown").width/4/2,this.camera.height/2-this.game.cache.getImage("countdown").height/2-this.game.cache.getImage("countdownLevel").width/10,"countdown"),this.groupInterface.add(this.interfaceCountdown),this.interfaceCountdownBox=this.add.sprite(this.camera.width/2-this.game.cache.getImage("countdownLevel").width/2,this.interfaceCountdown.height,"countdownLevel"),this.groupInterface.add(this.interfaceCountdownBox),this.interfaceCountdownLevel=this.add.bitmapText(this.interfaceCountdownBox.x+100,this.interfaceCountdownBox.y+20,"munro","Level "+this.level,100),this.interfaceCountdownLevel.anchor.setTo(0,0),this.groupInterface.add(this.interfaceCountdownLevel))},updateTouchControls:function(t){this.game.device.touch&&(this.interfaceTouchControlsLeft.visible=1===this.player.facing||t?!0:!1,this.interfaceTouchControlsRight.visible=1===this.player.facing||t?!1:!0)},updateScore:function(t){var e=function(t,e){var i="0000000000000000"+t;return i.substr(i.length-e)};this.levelScore+=t,this.interfaceLevelScore.setText(e(BasicGame.score+this.levelScore,7)+" Km"),e=null},updateLives:function(t){"add"===t?this.lives++:"subtract"===t&&this.lives--,this.interfaceLife.frame=this.lives},updateFuel:function(t){"add"===t?(this.fuel=this.fuel+100,this.fuel>200&&(this.fuel=200)):"subtract"===t?(this.fuel=this.fuel-.1,this.fuel<0&&this.player.kill()):this.fuel=200,this.interfaceFuel.frame=Math.round(this.fuel/20)},saveScore:function(){var t=function(t,e){return t.distance>e.distance?-1:t.distance<e.distance?1:0},e=new Date,i=e.getDate(),s=e.getMonth()+1,a=e.getFullYear(),n="xxyxxyxx-xyxx-zdz-xxyx-xxyxxyxxyxxx",h=n.replace(/[xy]/g,function(t){var e=16*Math.random()|0,i="x"==t?e:3&e|8;return i.toString(16)}),r=[],o=!1;if(i=10>i?"0"+i:i,s=10>s?"0"+s:s,a=a.toString().substr(2,2),store.forEach(function(t,e){-1!==t.indexOf("score")&&r.push(e)}),r.length>=0&&r.length<=8)store.set("score-"+h,{id:h,level:this.level,distance:BasicGame.score,date:i+"/"+s+"/"+a});else{r.sort(t);for(var d=0,c=r.length;c>d;d++)if(BasicGame.score>r[d].distance&&8>d){store.set("score-"+h,{id:h,level:this.level,distance:BasicGame.score,date:i+"/"+s+"/"+a}),o=!0;break}o&&r.length>=8&&store.remove("store-"+r[r.length-1].id)}t=e=i=s=a=n=h=r=o=null},collisionTile:function(t){var e={},i=this.mapLayerPlatforms.getTileX(t.x),s=this.mapLayerPlatforms.getTileY(t.y)+1;"player"===t.name&&(e=this.map.getTile(i,s,0),e&&(this.updateFuel("subtract"),e.index>0&&e.index<5&&!e.traveled&&(e.traveled=!0,this.addTerrain(e.index,e.worldX,e.worldY),this.updateScore(1),this.checkIfLevelCompleted()))),tile=e=i=s=null},collisionItem:function(t,e){"player"!==t.name||t.isRevived||!t.power||"enemy"!==e.name||e.isDesintegrated?"player"!==t.name||t.isRevived||t.power||"enemy"!==e.name?"player"!==t.name||t.isRevived||"fuel"!==e.name?"player"!==t.name||t.isRevived||"life"!==e.name?"player"!==t.name||t.isRevived||"power"!==e.name?"player"!==t.name||t.isRevived||"obstacle"!==e.name||(t.facing=-1*t.facing,t.run()):(e.kill(),t.run(),t.toPower(),this.time.events.add(15*Phaser.Timer.SECOND,t.toDisempower,t)):(e.kill(),t.run(),this.updateLives("add")):(e.kill(),t.run(),this.updateFuel("add")):(e.capturePlayer(),t.kill()):(e.desintegrate(),t.run())},onCollision:function(t,e){"player"!==t.name||"player"===e.name||this.levelCompleted||(this.collisionTile(t),this.collisionItem(t,e))},muteOnOff:function(){this.levelCompleted||(BasicGame.music?(BasicGame.music=!1,this.music.stop(),this.interfaceMute.frame=1):(BasicGame.music=!0,this.music.play("",0,1,!0),this.interfaceMute.frame=0))},pause:function(){this.game.paused||this.levelCompleted||(this.game.paused=!0)},onGamePause:function(){this.levelCompleted||(this.music.pause(),this.interfacePause.frame=1)},onGameResume:function(){this.levelCompleted||(this.music.resume(),this.interfacePause.frame=0)},tapController:function(t){(this.player&&this.player.alive&&!this.levelCompleted&&("btLeft"===t.key||"btRight"===t.key)||"btJump"===t.key&&this.player.body.onFloor()&&!this.player.isJumping&&0===this.player.deltaY)&&this.player.control(t.key)}},BasicGame.GameEnd=function(){this.game,this.add,this.camera,this.cache,this.input,this.load,this.math,this.sound,this.stage,this.time,this.tweens,this.world,this.particles,this.physics,this.rnd,this.map,this.mapLayerPlatforms,this.mapBackground,this.mapSky,this.music,this.counterEnemies=0,this.groupInterface,this.interfacePause,this.vignettesBg1,this.vignettesBg2,this.vignettesCar,this.vignettesEnemiesBg,this.vignettesEnemies1,this.vignettesEnemies2,this.vignettesEnemies3,this.vignettesText1,this.vignettesText2,this.vignettesText3,this.vignettesMsg,this.listenerEnemies},BasicGame.GameEnd.prototype={init:function(){this.counterEnemies=0},preload:function(t){t.load.tilemap("mapLevel","assets/tilemaps/maps/tilemap-10.json",null,Phaser.Tilemap.TILED_JSON),t.load.audio("musicLevel","assets/audio/single-1.ogg"),t.load.image("mapBackground","assets/img/bg-4.png"),t.load.image("mapSky","assets/img/bg-4-sky-3.png"),t.load.image("tilesTerrain","assets/tilemaps/tiles/terrain-4.png"),t.load.image("vigEnemyBg","assets/img/gameend-enemy-bg.png"),t.load.image("vigEnemy1","assets/img/gameend-enemy-1.png"),t.load.image("vigEnemy2","assets/img/gameend-enemy-2.png"),t.load.image("vigEnemy3","assets/img/gameend-enemy-3.png"),t.load.image("vigCar","assets/img/gameend-car.png"),t.load.image("msgGameEnd","assets/img/gameend-msg.png")},create:function(t){var e={},i={};this.mapSky=this.add.tileSprite(0,0,6500,768,"mapSky"),this.mapBackground=this.add.tileSprite(0,225,6500,768,"mapBackground"),this.map=this.add.tilemap("mapLevel"),this.map.addTilesetImage("terrain","tilesTerrain"),this.mapLayerPlatforms=this.map.createLayer(0),this.mapLayerPlatforms.resizeWorld(),this.groupInterface=this.add.group(),this.interfacePause=this.add.button(this.camera.x+this.camera.width-60,10,"btPause",this.pause,this,2,1,0),this.interfacePause.frame=0,this.interfacePause.fixedToCamera=!0,this.groupInterface.add(this.interfacePause),this.interfacePause.frame=t.paused?1:0,this.interfacePause.onInputOut.add(function(){this.interfacePause.frame=t.paused?1:0},this),e=this.add.sprite(-64,690,"player"),i={},e.animations.add("run-right",[0,1,2,3],15,!0),e.animations.play("run-right"),i=this.add.tween(e).to({x:this.camera.width},4e3,Phaser.Easing.Linear.None,!0,1e3),i.onStart.add(function(){this.listenerEnemies=this.time.events.loop(300,this.addEnemy,this)},this),i.onComplete.add(function(){e.destroy(),e=i=null},this),this.camera.focusOnXY(200,690),this.music=this.add.audio("musicLevel"),BasicGame.music&&this.music.play("",0,1,!1),t.onPause.add(this.onGamePause,this),t.onResume.add(this.onGameResume,this)},update:function(t){t.input.onDown.add(function(){t.paused=!1},this)},shutdown:function(){this.map.destroy(),this.mapLayerPlatforms.destroy(),this.mapBackground.destroy(),this.mapSky.destroy(),this.music.destroy(),this.groupInterface.destroy(),this.vignettesBg1.destroy(),this.vignettesBg2.destroy(),this.vignettesCar.destroy(),this.vignettesEnemiesBg.destroy(),this.vignettesEnemies1.destroy(),this.vignettesEnemies2.destroy(),this.vignettesEnemies3.destroy(),this.vignettesText1.destroy(),this.vignettesText2.destroy(),this.vignettesText3.destroy(),this.vignettesMsg.destroy(),this.cache.removeTilemap("mapLevel"),this.cache.removeSound("musicLevel"),this.cache.removeImage("mapBackground"),this.cache.removeImage("mapSky"),this.cache.removeImage("tilesTerrain"),this.cache.removeImage("vigEnemyBg"),this.cache.removeImage("vigEnemy1"),this.cache.removeImage("vigEnemy2"),this.cache.removeImage("vigEnemy3"),this.cache.removeImage("vigCar"),this.cache.removeImage("msgGameEnd")},quitGame:function(){this.music.stop(),this.state.start("MainMenu")},addEnemy:function(){var t=this.add.sprite(-75,690,"enemy-"+this.game.rnd.between(1,2)),e={};t.animations.add("run-right",[0,1,2,3],15,!0),t.animations.play("run-right"),e=this.add.tween(t).to({x:this.camera.width},this.game.rnd.between(4500,5500),Phaser.Easing.Linear.None,!0,0===this.counterEnemies?1e3:this.game.rnd.between(100,300)),e.onComplete.add(function(){t.destroy(),t=e=null},this),this.counterEnemies>60?(this.time.events.remove(this.listenerEnemies),this.time.events.add(1500,this.startVignettes,this)):this.counterEnemies++},startVignettes:function(){var t=this,e=this.add.bitmapData(this.camera.width,this.camera.height),i={};e.ctx.fillStyle="#000000",e.ctx.beginPath(),e.ctx.rect(0,0,e.width,e.height),e.ctx.closePath(),e.ctx.fill(),this.vignettesBg1=this.add.sprite(0,-1*e.height,e),this.vignettesCar=this.add.sprite(this.camera.width/2-this.game.cache.getImage("vigCar").width/2+25*this.camera.width/100,200,"vigCar"),this.vignettesEnemiesBg=this.add.sprite(this.camera.width/2-this.game.cache.getImage("vigEnemyBg").width/2-25*this.camera.width/100,this.camera.y,"vigEnemyBg"),this.vignettesEnemies1=this.add.sprite(this.vignettesEnemiesBg.width/2-this.game.cache.getImage("vigEnemy1").width/2+25*this.vignettesEnemiesBg.width/100,-1*this.game.cache.getImage("vigEnemy1").height,"vigEnemy1"),this.vignettesEnemies2=this.add.sprite(this.vignettesEnemiesBg.width/2-this.game.cache.getImage("vigEnemy2").width/2,-1*this.game.cache.getImage("vigEnemy2").height,"vigEnemy2"),this.vignettesEnemies3=this.add.sprite(this.vignettesEnemiesBg.width/2-this.game.cache.getImage("vigEnemy3").width/2,-1*this.game.cache.getImage("vigEnemy3").height,"vigEnemy3"),this.vignettesBg2=this.add.sprite(0,-1*e.height,e),this.vignettesMsg=this.add.sprite(this.camera.x+this.camera.width/2-this.game.cache.getImage("msgGameEnd").width/2,this.vignettesBg2.height/2*-1,"msgGameEnd"),this.vignettesCar.alpha=0,this.vignettesEnemiesBg.alpha=0,i=this.add.tween(this.vignettesBg1).to({y:this.camera.y},2e3,Phaser.Easing.Bounce.Out,!0,3e3),i.onComplete.add(function(){var s=this.add.tween(this.vignettesEnemiesBg).to({alpha:1},2e3,Phaser.Easing.Exponential.Out,!0);s.onComplete.add(function(){var e=this.add.tween(this.vignettesEnemies1).to({y:this.vignettesEnemiesBg.height/2-50},2e3,Phaser.Easing.Bounce.Out,!0),i=this.add.tween(this.vignettesEnemies2).to({y:this.vignettesEnemiesBg.height/2+75},2e3,Phaser.Easing.Bounce.Out,!0,1e3),a=this.add.tween(this.vignettesEnemies3).to({y:this.vignettesEnemiesBg.height/2-100},2e3,Phaser.Easing.Bounce.Out,!0,2e3);a.onComplete.add(function(){this.vignettesText1=this.add.bitmapText(this.camera.width/2,25,"munro","_",30),this.vignettesText1.fixedToCamera=!0,this.setMsgText(this.vignettesText1,"They have been unable to catch you...",function(){var e=t.add.tween(t.vignettesCar).to({alpha:1},1e3,Phaser.Easing.Linear.None,!0);e.onComplete.add(function(){t.vignettesText2=t.add.bitmapText(t.vignettesEnemiesBg.x+20*t.vignettesEnemiesBg.width/100,t.vignettesEnemiesBg.height+60,"munro","_",30),t.vignettesText2.fixedToCamera=!0,t.setMsgText(t.vignettesText2,"You have successfully escaped",function(){t.vignettesText3=t.add.bitmapText(t.vignettesText2.width/1.5,t.vignettesText2.y+35,"munro","_",30),t.vignettesText3.fixedToCamera=!0,t.setMsgText(t.vignettesText3,"WELL DONE!!!",function(){var e=t.add.tween(t.vignettesBg2).to({y:t.camera.y},2e3,Phaser.Easing.Bounce.Out,!0,5e3),i=t.add.tween(t.vignettesMsg).to({y:t.camera.height/2},2e3,Phaser.Easing.Bounce.Out,!0,5e3);e.onStart.add(function(){t.vignettesText1.visible=!1,t.vignettesText2.visible=!1,t.vignettesText3.visible=!1},t),e.onComplete.add(function(){this.time.events.add(3*Phaser.Timer.SECOND,this.quitGame,this),t=e=i=null},t)})}),e=null},t)}),e=i=a=null},this),s=null},this),e=i=null},this)},setMsgText:function(t,e,i,s){var s=s||1;e.length>=s?(t.setText(e.substring(0,s)+"_"),this.time.events.add(100,this.setMsgText,this,t,e,i,s+1)):(t.setText(e.substring(0,s)),"function"==typeof i&&i()),s=null},pause:function(){this.game.paused||(this.game.paused=!0)},onGamePause:function(){this.music.pause(),this.interfacePause.frame=1},onGameResume:function(){this.music.resume(),this.interfacePause.frame=0}},BasicGame.MainMenu=function(){this.btPlay={},this.btWeb={},this.btInfo={},this.btScore={},this.btMusic={},this.music={},this.scoresTxt,this.scoresBg,this.creditsTxt,this.creditsBg},BasicGame.MainMenu.prototype={preload:function(t){this.load.spritesheet("btMusic","assets/img/bt-music.png",80,80),this.background=this.add.sprite(this.camera.width/2-t.cache.getImage("mainBackground").width/2,0,"mainBackground")},create:function(t){var e=this.add.sprite(-500,500,"mainCar"),i=this.add.sprite(this.background.x,this.background.height-t.cache.getImage("mainRoad").height,"mainRoad"),s={};this.music=this.add.audio("music"),BasicGame.music&&this.music.play("",0,1,!0),s=this.add.tween(e).to({x:this.background.x-50,y:this.background.y-350},1500,Phaser.Easing.Exponential.Out,!0),s.onComplete.add(function(){var a=this.add.sprite(this.background.x+100,this.background.height-t.cache.getImage("mainRoad").height+10,"mainCarShadow"),n=this.add.tween(e).to({x:this.background.x+20,y:this.background.height-t.cache.getImage("mainCar").height-225},1500,Phaser.Easing.Bounce.Out,!0),h=this.add.tween(a).to({alpha:1},1500,Phaser.Easing.Bounce.Out,!1);
a.alpha=0,h.start(),n.onComplete.add(function(){var r=this.add.sprite(this.background.x+this.background.width-(t.cache.getImage("mainTitle").width+20),this.background.height,"mainTitle"),o=this.add.tween(r).to({y:0},250,Phaser.Easing.Linear.None,!0);o.onComplete.add(function(){var d=(this.add.sprite(r.x+r.width/2-t.cache.getImage("mainLogoZdz").width/2,this.camera.height-t.cache.getImage("mainLogoZdz").height-10,"mainLogoZdz"),{}),c={},m={},l={},u={};this.btPlay=this.add.button(r.x+r.width/2-t.cache.getImage("btPlay").width/6,515,"btPlay",this.startGame,this,2,1,0),this.btPlay.alpha=0,this.btWeb=this.add.button(i.x+10,this.camera.height-90,"btWeb",this.openWeb,this,2,1,0),this.btWeb.alpha=0,this.btScore=this.add.button(i.x+100,this.camera.height-90,"btScore",this.scores,this,2,1,0),this.btScore.alpha=0,this.btScore.frame=1,this.btScore.onInputOut.add(function(){this.scoresBg&&(this.btScore.frame=this.scoresBg.y>-700?0:1)},this),this.btInfo=this.add.button(i.x+190,this.camera.height-90,"btInfo",this.credits,this,2,1,0),this.btInfo.alpha=0,this.btInfo.frame=1,this.btInfo.onInputOut.add(function(){this.creditsBg&&(this.btInfo.frame=this.creditsBg.y>-700?0:1)},this),this.btMusic=this.add.button(i.x+280,this.camera.height-90,"btMusic",this.muteOnOff,this,2,1,0),this.btMusic.alpha=0,this.btMusic.frame=BasicGame.music?0:1,this.btMusic.onInputOut.add(function(){this.btMusic.frame=BasicGame.music?0:1},this),c=this.add.tween(this.btWeb).to({alpha:1},1500,Phaser.Easing.Exponential.Out,!0,1e3),m=this.add.tween(this.btScore).to({alpha:1},1500,Phaser.Easing.Exponential.Out,!0,1250),l=this.add.tween(this.btInfo).to({alpha:1},1500,Phaser.Easing.Exponential.Out,!0,1500),u=this.add.tween(this.btMusic).to({alpha:1},1500,Phaser.Easing.Exponential.Out,!0,1750),d=this.add.tween(this.btPlay).to({alpha:1},1500,Phaser.Easing.Exponential.Out,!0,2e3),d.onComplete.add(function(){e=a=i=r=s=n=h=o=c=m=l=u=d=null},this)},this)},this)},this)},update:function(){},shutdown:function(){this.cache.removeImage("btMusic"),this.btPlay.destroy(),this.btWeb.destroy(),this.btInfo.destroy(),this.btMusic.destroy(),this.music.destroy(),this.creditsBg&&(this.creditsBg.destroy(),this.creditsTxt.destroy()),this.btPlay=null,this.btWeb=null,this.btInfo=null,this.btMusic=null,this.music=null,this.creditsBg=null,this.creditsTxt=null},muteOnOff:function(){BasicGame.music?(BasicGame.music=!1,this.music.stop(),this.btMusic.frame=1):(BasicGame.music=!0,this.music.play("",0,1,!0),this.btMusic.frame=0)},openWeb:function(){this.game.device.cocoonJS?Cocoon.App.openURL("http://www.zdzapps.com"):window.open("http://www.zdzapps.com")},startGame:function(){var t=this.add.audio("play"),e=this.add.tween(this.btPlay).to({y:this.camera.height},1e3,Phaser.Easing.Bounce.Out,!0,100),i=this.add.tween(this.btWeb).to({y:this.camera.height},1e3,Phaser.Easing.Bounce.Out,!0,200),s=this.add.tween(this.btScore).to({y:this.camera.height},1e3,Phaser.Easing.Bounce.Out,!0,300),a=this.add.tween(this.btInfo).to({y:this.camera.height},1e3,Phaser.Easing.Bounce.Out,!0,400),n=this.add.tween(this.btMusic).to({y:this.camera.height},1e3,Phaser.Easing.Bounce.Out,!0,500);t.onStop.add(function(){this.state.start("Game")},this),this.music.stop(),t.play(),t=e=i=s=a=n=null},scores:function(){var t=function(t,e){var i="0000000000000000"+t;return i.substr(i.length-e)},e=function(t,e){return t.distance>e.distance?-1:t.distance<e.distance?1:0},i={x:this.background.x+this.background.width-(this.game.cache.getImage("mainTitle").width+20),y:-700},s={},a={},n={},h=[],r=["\n\n","\nCITY CARS – BARCELONA\n","\nHIGH SCORES\n\n\n","\nLEVEL     DISTANCE           DATE       \n"];if(store.forEach(function(t,e){-1!==t.indexOf("score")&&h.push(e)}),0===h.length)r.push("\n         ...          ...                    ...                  \n");else{h.sort(e);for(var o=0,d=h.length<8?h.length:8;d>o;o++)r.push("\n       "+h[o].level+"         "+t(h[o].distance,7)+" Km      "+h[o].date+"       \n")}r=r.join(""),(this.creditsBg||this.creditsTxt)&&this.credits(),this.scoresBg&&this.scoresTxt||(n=new Phaser.BitmapData(this.game,"bmd",this.game.cache.getImage("mainTitle").width,this.background.height-50),n.ctx.fillStyle="black",n.ctx.beginPath(),n.ctx.rect(0,0,n.width,n.height),n.ctx.closePath(),n.ctx.fill(),this.scoresBg=this.add.sprite(i.x,i.y,n),this.scoresTxt=this.add.bitmapText(i.x,i.y,"munro",r,24),this.scoresTxt.anchor.setTo(0,0),this.scoresTxt.width=this.game.cache.getImage("mainTitle").width,this.scoresTxt.align="center"),0===this.scoresBg.y?(s=this.add.tween(this.scoresBg).to({y:-700},1e3,Phaser.Easing.Bounce.Out,!0),a=this.add.tween(this.scoresTxt).to({y:-700},1e3,Phaser.Easing.Bounce.Out,!0)):(s=this.add.tween(this.scoresBg).to({y:0},1e3,Phaser.Easing.Bounce.Out,!0),a=this.add.tween(this.scoresTxt).to({y:0},1e3,Phaser.Easing.Bounce.Out,!0)),s.onComplete.add(function(){this.btScore.frame=0===this.scoresBg.y?0:1,s=a=null,-700===this.scoresBg.y&&(this.scoresBg.destroy(),this.scoresTxt.destroy(),this.scoresBg=null,this.scoresTxt=null)},this),delete i.x,delete i.y,t=e=i=n=h=r=null},credits:function(){var t={},e={},i={},s={x:this.background.x+this.background.width-(this.game.cache.getImage("mainTitle").width+20),y:-700},a=["\nORIGINAL IDEA\n","Jaleco (1985)\n","\nGRAPHICS AND DEVELOPMENT\n","ZDZ Touch & Play (zdzapps.com)\n","\nGAME ENGINE\n","Phaser by PhotonStorm.com\n","\nLEVEL MAPS\n","Tiled by MapEditor.org\n","\nPACKAGER AND RENDERING\n","CocoonJS by Ludei.com\n","\nAUDIO ENCODING\n","Ogg Vorbis\n","\nMUSIC BY Paltian.com\n","Waiting\n","Ready!\n","The race\n","Blue & White\n","Freedom!"].join("");(this.scoresBg||this.scoresTxt)&&this.scores(),this.creditsBg&&this.creditsTxt||(i=new Phaser.BitmapData(this.game,"bmd",this.game.cache.getImage("mainTitle").width,this.background.height-50),i.ctx.fillStyle="black",i.ctx.beginPath(),i.ctx.rect(0,0,i.width,i.height),i.ctx.closePath(),i.ctx.fill(),this.creditsBg=this.add.sprite(s.x,s.y,i),this.creditsTxt=this.add.bitmapText(s.x+20,s.y,"munro",a,25),this.creditsTxt.anchor.setTo(0,0)),0===this.creditsBg.y?(t=this.add.tween(this.creditsBg).to({y:-700},1e3,Phaser.Easing.Bounce.Out,!0),e=this.add.tween(this.creditsTxt).to({y:-700},1e3,Phaser.Easing.Bounce.Out,!0)):(t=this.add.tween(this.creditsBg).to({y:0},1e3,Phaser.Easing.Bounce.Out,!0),e=this.add.tween(this.creditsTxt).to({y:0},1e3,Phaser.Easing.Bounce.Out,!0)),t.onComplete.add(function(){this.btInfo.frame=0===this.creditsBg.y?0:1,t=e=null,-700===this.creditsBg.y&&(this.creditsBg.destroy(),this.creditsTxt.destroy(),this.creditsBg=null,this.creditsTxt=null)},this),delete s.x,delete s.y,i=a=s=null}},BasicGame.Preloader=function(){this.background=null,this.preloadBar=null,this.ready=!1},BasicGame.Preloader.prototype={preload:function(t){this.background=this.add.sprite(this.camera.width/2-this.game.cache.getImage("preloaderBackground").width/2,0,"preloaderBackground"),this.preloaderBar=this.add.sprite(this.camera.width/2-this.game.cache.getImage("preloaderBar").width/2,440,"preloaderBar"),this.load.setPreloadSprite(this.preloaderBar),this.load.audio("music","assets/audio/single-main.ogg"),this.load.audio("play","assets/audio/car-ignition.ogg"),this.load.image("mainBackground","assets/img/main-bg.png"),this.load.image("mainTitle","assets/img/main-title.png"),this.load.image("mainRoad","assets/img/main-road.png"),this.load.image("mainCar","assets/img/main-car.png"),this.load.image("mainCarShadow","assets/img/main-car-shadow.png"),this.load.image("mainLogoZdz","assets/img/main-logo-zdz.png"),this.load.image("countdownLevel","assets/img/countdown-level.png"),this.load.image("msgGameOver","assets/img/msg-gameover.png"),this.load.image("msgLevelCompleted","assets/img/msg-levelcompleted.png"),this.load.image("itemFuel","assets/img/item-fuel.png"),this.load.image("itemObstacle","assets/img/item-obstacle.png"),this.load.spritesheet("itemLife","assets/img/item-life.png",28,28,2),this.load.spritesheet("itemPower","assets/img/item-power.png",28,28,4),this.load.spritesheet("countdown","assets/img/countdown.png",215,606,4),this.load.spritesheet("lifeCounter","assets/img/life.png",250,50,6),this.load.spritesheet("fuelCounter","assets/img/fuel.png",200,50,11),this.load.spritesheet("player","assets/img/player.png",60,48,40),this.load.spritesheet("enemy-1","assets/img/enemy-1.png",72,53,44),this.load.spritesheet("enemy-2","assets/img/enemy-2.png",72,54,44),this.load.spritesheet("enemy-3","assets/img/enemy-3.png",126,70,44),this.load.spritesheet("btWeb","assets/img/bt-web.png",80,80),this.load.spritesheet("btInfo","assets/img/bt-info.png",80,80),this.load.spritesheet("btScore","assets/img/bt-score.png",80,80),this.load.spritesheet("btPlay","assets/img/bt-play.png",150,150),this.load.spritesheet("btPause","assets/img/bt-pause.png",50,50),this.load.spritesheet("btContinue","assets/img/bt-continue.png",300,100),t.device.touch&&(this.load.spritesheet("btLeft","assets/img/bt-left.png",150,150),this.load.spritesheet("btRight","assets/img/bt-right.png",150,150),this.load.spritesheet("btJump","assets/img/bt-jump.png",150,150)),t.device.cocoonJS&&Cocoon.Ad.loadInterstitial()},create:function(){this.preloaderBar.cropEnabled=!1},shutdown:function(){this.background.destroy(),this.preloaderBar.destroy()},update:function(){this.cache.isSoundDecoded("music")&&!this.ready&&(this.ready=!0,this.state.start("MainMenu"))}};var Enemy=function(t,e,i){Phaser.Sprite.call(this,t,e,i,"enemy-"+t.rnd.between(1,3)),this.name="enemy",this.smoothed=!1,this.autoCull=!0,this.state=t.state.getCurrentState(),this.facing=1,this.velocity=0,this.jumpTimer=0,this.transitionTimer=0,this.isJumping=!1,this.isInTransition=!1,this.isInCapture=!1,this.isDesintegrated=!1,this.inCameraOut=!1,this.anchor.setTo(.5,.8),this.anim={runRight:this.animations.add("run-right",[0,1,2,3],15,!0),runLeft:this.animations.add("run-left",[22,23,24,25],15,!0),jumpRightUp:this.animations.add("jump-right-up",[4,5,6,7,8],15,!1),jumpRightDown:this.animations.add("jump-right-down",[9,10,11,12,4],15,!1),jumpLeftUp:this.animations.add("jump-left-up",[26,27,28,29,30],15,!1),jumpLeftDown:this.animations.add("jump-left-down",[31,32,33,34,26],15,!1),captureRightFront:this.animations.add("capture-right-front",[13],1,!1),captureRightBack:this.animations.add("capture-right-back",[14],1,!1),captureLeftFront:this.animations.add("capture-left-front",[35],1,!1),captureLeftBack:this.animations.add("capture-left-back",[36],1,!1),desintegrateRight:this.animations.add("desintegrate-right",[15,16,17,18,19,20,21],30,!1),desintegrateLeft:this.animations.add("desintegrate-left",[37,38,39,40,41,42,43],30,!1)},this.anim.jumpRightDown.onComplete.add(function(){this.animations.play("run-right"),this.run()},this),this.anim.jumpLeftDown.onComplete.add(function(){this.animations.play("run-left"),this.run()},this),this.anim.desintegrateRight.onComplete.add(function(){this.dead()},this),this.anim.desintegrateLeft.onComplete.add(function(){this.dead()},this)};Enemy.prototype=Object.create(Phaser.Sprite.prototype),Enemy.prototype.constructor=Enemy,Enemy.prototype.update=function(){this.isJumping=this.game.time.now<this.jumpTimer?!0:!1,this.isInTransition=this.game.time.now<this.transitionTimer?!0:!1,this.control()},Enemy.prototype.run=function(){this.state.levelCompleted||this.isDesintegrated||!this.alive||(this.isInCapture=!1,this.animations.play(1===this.facing?"run-right":"run-left"),this.body.velocity.x=this.velocity*this.facing)},Enemy.prototype.dead=function(){this.kill(),this.isDesintegrated=!1,this.inCameraOut=!1,this.state.groupActors.countDead()>5&&this.game.time.events.add(Phaser.Timer.SECOND/5,this.destroy,this)},Enemy.prototype.desintegrate=function(){this.isDesintegrated||(this.isDesintegrated=!0,this.animations.play(1===this.facing?"desintegrate-right":"desintegrate-left"))},Enemy.prototype.capturePlayer=function(){this.isInCapture=!0,this.body.velocity.x=0,this.animations.play(this.x>this.state.player.x?1===this.facing?"capture-right-back":"capture-left-front":1===this.facing?"capture-right-front":"capture-left-back"),this.game.time.events.add(2*Phaser.Timer.SECOND,this.run,this)},Enemy.prototype.setFacing=function(){var t=0;t=this.x<this.state.player.x?1===this.state.player.facing?1:this.state.rnd.normal()<0?-1:1:-1===this.state.player.facing?-1:this.state.rnd.normal()<0?-1:1,this.facing=t,t=null},Enemy.prototype.setVelocity=function(){var t=0;t=this.x<this.state.player.x?1===this.facing&&1===this.state.player.facing?this.game.rnd.between(this.state.gameSpeed+25,this.state.gameSpeed+30):-1===this.facing&&-1===this.state.player.facing?this.game.rnd.between(this.state.gameSpeed-25,this.state.gameSpeed-30):1===this.facing&&-1===this.state.player.facing?this.game.rnd.between(this.state.gameSpeed-15,this.state.gameSpeed+15):this.state.gameSpeed:1===this.state.player.facing&&1===this.facing?this.game.rnd.between(this.state.gameSpeed-25,this.state.gameSpeed-30):-1===this.state.player.facing&&-1===this.facing?this.game.rnd.between(this.state.gameSpeed+25,this.state.gameSpeed+30):1===this.state.player.facing&&-1===this.facing?this.game.rnd.between(this.state.gameSpeed-15,this.state.gameSpeed+15):this.state.gameSpeed,this.velocity=t,t=null},Enemy.prototype.control=function(){this.state.levelCompleted||this.isInCapture||this.isDesintegrated?this.state.levelCompleted&&(this.body.velocity.x=0):(this.inCamera&&!this.inCameraOut&&(this.inCameraOut=!0),!this.isInTransition&&(1===this.state.mapLayerPlatforms.getTileX(this.x)||this.state.mapLayerPlatforms.getTileX(this.x)===this.state.map.width-2)||!this.inCamera&&this.inCameraOut?this.dead():!this.isJumping&&0===this.deltaY&&!this.state.checkToJump("ceiling",this)&&this.state.checkToJump("platform",this)&&this.state.player.y+64<this.y&&!this.state.player.isJumping&&this.game.rnd.normal()>0?(this.jumpTimer=this.game.time.now+1500,this.body.velocity.x=this.state.gameSpeed/1.2*this.facing,this.body.velocity.y=!this.state.checkToJump("ceiling",this)&&this.state.checkToJump("platform",this)?-595:-440,this.animations.play(1===this.facing?"jump-right-up":"jump-left-up")):!this.isJumping&&this.deltaY>0&&(this.body.velocity.x=this.state.gameSpeed/1.2*this.facing,this.animations.play(1===this.facing?"jump-right-down":"jump-left-down")))};var Player=function(t,e,i){Phaser.Sprite.call(this,t,e,i,"player"),this.name="player",this.smoothed=!1,this.state=t.state.getCurrentState(),this.facing=1,this.velocity=this.state.gameSpeed,this.jumpTimer=0,this.transitionTimer=0,this.power=!1,this.isJumping=!1,this.isInTransition=!1,this.isRevived=!1,this.anchor.setTo(.5,.8),this.anim={runRight:this.animations.add("run-right",[0,1,2,3],15,!0),runLeft:this.animations.add("run-left",[20,21,22,23],15,!0),jumpRightUp:this.animations.add("jump-right-up",[4,5],15,!1),jumpRightDown:this.animations.add("jump-right-down",[6,4],15,!1),jumpLeftUp:this.animations.add("jump-left-up",[24,25],15,!1),jumpLeftDown:this.animations.add("jump-left-down",[26,24],15,!1),turnRight:this.animations.add("turn-right",[9],4,!1),turnLeft:this.animations.add("turn-left",[29],4,!1),deadRight:this.animations.add("dead-right",[10,11],15,!0),deadLeft:this.animations.add("dead-left",[30,31],15,!0),runRightPower:this.animations.add("run-right-power",[12,13,14,15],15,!0),runLeftPower:this.animations.add("run-left-power",[32,33,34,35],15,!0),jumpRightUpPower:this.animations.add("jump-right-up-power",[16,17],15,!1),jumpRightDownPower:this.animations.add("jump-right-down-power",[18,16],15,!1),jumpLeftUpPower:this.animations.add("jump-left-up-power",[36,37],15,!1),jumpLeftDownPower:this.animations.add("jump-left-down-power",[38,36],15,!1),turnRightPower:this.animations.add("turn-right-power",[19],4,!1),turnLeftPower:this.animations.add("turn-left-power",[39],4,!1)},this.listenerPower,this.listenerRevive,this.events.onKilled.add(function(){this.dead()},this),this.anim.jumpRightDown.onComplete.add(function(){this.animations.play("run-right"),this.run()},this),this.anim.jumpLeftDown.onComplete.add(function(){this.animations.play("run-left"),this.run()},this),this.anim.turnRight.onComplete.add(function(){this.animations.play("run-right"),this.run()},this),this.anim.turnLeft.onComplete.add(function(){this.animations.play("run-left"),this.run()},this),this.anim.jumpRightDownPower.onComplete.add(function(){this.animations.play("run-right-power"),this.run()},this),this.anim.jumpLeftDownPower.onComplete.add(function(){this.animations.play("run-left-power"),this.run()},this),this.anim.turnRightPower.onComplete.add(function(){this.animations.play("run-right-power"),this.run()},this),this.anim.turnLeftPower.onComplete.add(function(){this.animations.play("run-left-power"),this.run()},this)};Player.prototype=Object.create(Phaser.Sprite.prototype),Player.prototype.constructor=Player,Player.prototype.update=function(){this.isJumping=this.game.time.now<this.jumpTimer?!0:!1,this.isInTransition=this.game.time.now<this.transitionTimer?!0:!1,this.control()},Player.prototype.run=function(){this.state.levelCompleted||(this.animations.play(this.power?1===this.facing?"run-right-power":"run-left-power":1===this.facing?"run-right":"run-left"),this.body.mass=2,this.body.velocity.x=this.velocity*this.facing,this.state.updateTouchControls())},Player.prototype.dead=function(){this.state.updateLives("subtract"),this.clearPower(),this.state.lives>0?(this.visible=!0,this.state.updateTouchControls(!0),this.game.time.events.add(2*Phaser.Timer.SECOND,this.revive,this)):(this.visible=!0,this.animations.play(1===this.facing?"dead-right":"dead-left"),this.state.gameOver())},Player.prototype.revive=function(){this.facing=1,this.power=!1,this.isRevived=!0,this.body.checkCollision.top=!1,this.body.checkCollision.right=!1,this.body.checkCollision.bottom=!1,this.body.checkCollision.left=!1,this.game.camera.focusOnXY(0,0),this.state.updateFuel(),this.reset(100,650),this.run(),this.listenerRevive=this.game.time.events.loop(Phaser.Timer.SECOND/4,this.statusRevive,this),this.game.time.events.add(3*Phaser.Timer.SECOND,this.clearRevive,this)},Player.prototype.statusRevive=function(){this.alpha=1===this.alpha&&this.isRevived?.5:1},Player.prototype.clearRevive=function(){this.game.time.events.remove(this.listenerRevive),this.alpha=1,this.isRevived=!1,this.body.checkCollision.top=!0,this.body.checkCollision.right=!0,this.body.checkCollision.bottom=!0,this.body.checkCollision.left=!0},Player.prototype.toPower=function(){this.power=!0,this.animations.play(1===this.facing?"run-right-power":"run-left-power")},Player.prototype.toDisempower=function(){this.listenerPower=this.game.time.events.loop(Phaser.Timer.SECOND/4,this.statusPower,this),this.game.time.events.add(5*Phaser.Timer.SECOND,this.clearPower,this)},Player.prototype.statusPower=function(){this.alpha=1===this.alpha&&this.power?.5:1},Player.prototype.clearPower=function(){this.game.time.events.remove(this.listenerPower),this.animations.play(1===this.facing?"run-right":"run-left"),this.alpha=1,this.power=!1},Player.prototype.checkTransitionScroll=function(){this.isInTransition||0!==this.state.mapLayerPlatforms.getTileX(this.x)?this.isInTransition||this.state.mapLayerPlatforms.getTileX(this.x)!==this.state.map.width-1?this.isInTransition&&this.run():(this.x=0,this.transitionTimer=this.game.time.now+200):(this.x=this.state.map.widthInPixels,this.transitionTimer=this.game.time.now+200)},Player.prototype.control=function(t){var e=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},i={direction:null,facing:null,animation:null},s=this.animations.currentAnim.name;this.checkTransitionScroll(),(this.state.cursors||t)&&(i.direction=this.state.cursors.left.isDown||"btLeft"===t?"left":this.state.cursors.right.isDown||"btRight"===t?"right":null,null!==i.direction&&(i.facing="left"===i.direction&&1===this.facing?-1:"right"===i.direction&&-1===this.facing?1:null,null!==i.facing&&(this.facing=i.facing,i.animation="/^(turn"+e(i.direction)+")/g",-1===s.search(i.animation)&&(this.body.velocity.x=this.velocity/2*this.facing*-1,this.animations.play(this.power?"turn-"+i.direction+"-power":"turn-"+i.direction)),this.state.mapBackground.autoScroll(30*this.facing*-1,0)))),(this.state.jumpButton&&this.state.jumpButton.isDown||"btJump"===t)&&!this.isJumping&&0===this.deltaY?(this.game.device.touch&&(this.state.interfaceTouchControlsJump.inputEnabled=!1,this.state.interfaceTouchControlsJump.frame=0),this.animations.play(this.power?1===this.facing?"jump-right-up-power":"jump-left-up-power":1===this.facing?"jump-right-up":"jump-left-up"),this.jumpTimer=this.game.time.now+1500,this.body.velocity.y=!this.state.checkToJump("ceiling",this)&&this.state.checkToJump("platform",this)?-595:-440):!this.game.device.touch||this.state.interfaceTouchControlsJump.inputEnabled||this.isJumping?this.deltaY>0&&this.animations.play(this.power?1===this.facing?"jump-right-down-power":"jump-left-down-power":1===this.facing?"jump-right-down":"jump-left-down"):(this.state.interfaceTouchControlsJump.inputEnabled=!0,this.state.interfaceTouchControlsJump.frame=1),delete i.direction,delete i.facing,delete i.animation,e=i=s=null};var Fuel=function(t,e,i){Phaser.Sprite.call(this,t,e,i,"itemFuel"),this.name="fuel",this.smoothed=!1,this.autoCull=!0,this.state=t.state.getCurrentState(),this.anchor.setTo(.5,.8),this.events.onKilled.add(function(){this.dead()},this)};Fuel.prototype=Object.create(Phaser.Sprite.prototype),Fuel.prototype.constructor=Fuel,Fuel.prototype.update=function(){},Fuel.prototype.dead=function(){this.game.time.events.add(20*Phaser.Timer.SECOND,this.recicleFuel,this)},Fuel.prototype.recicleFuel=function(){var t=this.state.getItemPosition(!0);this.reset(t.x,t.y),delete t.x,delete t.y,t=null};var Life=function(t,e,i){Phaser.Sprite.call(this,t,e,i,"itemLife"),this.name="life",this.smoothed=!1,this.autoCull=!0,this.state=t.state.getCurrentState(),this.anchor.setTo(.5,.8),this.animations.add("cycle"),this.animations.play("cycle",5,!0),this.events.onKilled.add(function(){this.dead()},this)};Life.prototype=Object.create(Phaser.Sprite.prototype),Life.prototype.constructor=Life,Life.prototype.update=function(){},Life.prototype.dead=function(){5===this.state.lives?this.game.time.events.add(Phaser.Timer.MINUTE/2,this.dead,this):this.game.time.events.add(this.game.rnd.between(2*Phaser.Timer.MINUTE,2.5*Phaser.Timer.MINUTE),this.recicleLife,this)},Life.prototype.recicleLife=function(){var t=this.state.getItemPosition(!0);this.reset(t.x,t.y),delete t.x,delete t.y,t=null};var Obstacle=function(t,e,i){Phaser.Sprite.call(this,t,e,i,"itemObstacle"),this.name="obstacle",this.smoothed=!1,this.autoCull=!0,this.state=t.state.getCurrentState(),this.inCameraOut=!1,this.anchor.setTo(.5,.8),this.events.onKilled.add(function(){this.dead()},this)};Obstacle.prototype=Object.create(Phaser.Sprite.prototype),Obstacle.prototype.constructor=Obstacle,Obstacle.prototype.update=function(){!this.inCamera&&this.inCameraOut?this.kill():this.inCamera&&!this.inCameraOut&&(this.inCameraOut=!0)},Obstacle.prototype.dead=function(){this.inCameraOut=!1,this.game.time.events.add(this.game.rnd.between(Phaser.Timer.MINUTE/4,Phaser.Timer.MINUTE/2),this.recicleObstacle,this)},Obstacle.prototype.recicleObstacle=function(){var t=this.state.getItemPosition(!0);this.reset(t.x,t.y),delete t.x,delete t.y,t=null};var Power=function(t,e,i){Phaser.Sprite.call(this,t,e,i,"itemPower"),this.name="power",this.smoothed=!1,this.autoCull=!0,this.state=t.state.getCurrentState(),this.anchor.setTo(.5,.8),this.animations.add("cycle"),this.animations.play("cycle",5,!0),this.events.onKilled.add(function(){this.dead()},this)};Power.prototype=Object.create(Phaser.Sprite.prototype),Power.prototype.constructor=Power,Power.prototype.update=function(){},Power.prototype.dead=function(){this.game.time.events.add(this.game.rnd.between(1.5*Phaser.Timer.MINUTE,2*Phaser.Timer.MINUTE),this.reciclePower,this)},Power.prototype.reciclePower=function(){var t=this.state.getItemPosition(!0);this.reset(t.x,t.y),delete t.x,delete t.y,t=null};